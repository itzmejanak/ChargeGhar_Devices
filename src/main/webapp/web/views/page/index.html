<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IOT DEMO</title>
  <#include "/web/views/common/header.html" />
</head>
<style>
    .layui-form-label{
        width: 120px !important;
    }
</style>
<body>
<div class="layui-fluid" id="vue1">
    <div class="layui-card">
        <div class="layui-card-body" style="padding: 50px 15px">
            <form class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">MQTT Broker</label>
                    <div class="layui-col-xs3">
                        <input readonly="readonly" type="text" value="${mqttBroker}" lay-verify="required" placeholder="EMQX Cloud Broker" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">MQTT Username</label>
                    <div class="layui-col-xs3">
                        <input readonly="readonly" type="text" value="${mqttUsername}" placeholder="EMQX Username" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">ProductKey</label>
                    <div class="layui-col-xs3">
                        <input readonly="readonly" type="text" value="${data.productKey}" placeholder="Product Key" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">MQTT Connection</label>
                    <div class="layui-col-xs3">
                        <input readonly="readonly" type="text" value="${mqtt}" placeholder="MQTT Connection String" class="layui-input">
                    </div>
                    <div class="layui-form-mid"></div>
                    <div class="layui-input-block">
                        <a href="${_contextPath}/listen.html" target="_blank" class="layui-btn ">MQTT LISTENER</a>
                        <a href="javascript:vue1.createDevice()" class="layui-btn ">CREATE DEVICE BY DEVICENAME</a>
                        <a href="${_contextPath}/version.html" target="_blank" class="layui-btn ">ONLINE UPDATE</a>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">Document</label>
                    <div>
                        <a class="layui-btn layui-btn-normal" href="https://www.yuque.com/books/share/d7c5925d-2986-467f-afa9-3f951ceda881" target="_blank">About this demo</a>
                        <a class="layui-btn layui-btn-normal" href="https://www.yuque.com/books/share/e0c78792-9c1c-4a6c-896e-7e2e25722fc6" target="_blank">Chargeing Box API</a>
                        <a class="layui-btn layui-btn-normal" href="https://www.yuque.com/books/share/726cdd6c-a6cc-40ea-8e03-15d5beaf24f7" target="_blank">共享充电柜API</a>
                        <a class="layui-btn layui-btn-normal" href="https://www.yuque.com/books/share/e153414b-d778-4239-9971-151d7cd949e5" target="_blank">桌面式广告充电API</a>
                    </div>
                </div>

                <hr>

                <!--表格显示-->
                <table id="table1" lay-filter="table1"></table>

            </form>
        </div>
    </div>
</div>

<#include "/web/views/common/script.html" />
<script type="text/html" id="tools">
    <a class="layui-btn layui-btn-primary layui-btn-xs layui-bg-green" href="{{d.connectUrl}}" target="_blank">CONNECT API</a>
    <a class="layui-btn layui-btn-primary layui-btn-xs layui-bg-green" href="${_contextPath}/show.html?deviceName={{d.deviceName}}" target="_blank">CONTROL</a>
</script>

<script>
    var list = [];
    <#list deviceInfos as item>
        list.push({'deviceName': '${item.deviceName}', 'status' : '${item.deviceOnline}', 'connectUrl' : '${item.connectUrl}', 'hardware' : '${item.hardware}'});
    </#list>

    var vue1 = new Vue({
        el: '#vue1',
        data: {
            data: list
        },
        methods: {
            //初始化数据
            init: function () {
                layui.table.render({
                    elem: '#table1',
                    height: 'full-250',
                    data : vue1.data,
                    limit:100,
                    cols: [[
                        {type:'numbers', width:50},
                        {field: 'deviceName', title: 'DeviceName', sort: true},
                        {field: 'hardware', title: 'hardware', sort: true, templet: function (d) {
                                return d.hardware || 'UNKNOW';
                        }},
                        {field: 'status', title: 'Status', sort: true, templet: function (d) {
                            var temp = '<span class="layui-badge {0}">{1}</span>';
                            var style = d.status == 'ONLINE' ? 'layui-bg-green' : 'layui-bg-gray';
                            temp = temp.format(style, d.status);
                            return temp;
                        }},
                        {title: 'Menu', align : 'center', toolbar : '#tools', fixed: 'right'}
                    ]],
                    //skin: 'line'
                });
            },
            createDevice: function () {
                layer.prompt({title: 'Create deivce by UUID/IMEI/SN', formType: 0, btn: ['CREATE', 'CANCEL']}, function (value, index) {
                    if(value.length < 5){
                        layer.msg('DeviceName should be 5—20 length', {anim: 6});
                        layer.close(index);
                        return;
                    }
                    $.ajax({
                        type: 'POST',
                        url: '${_contextPath}/device/create',
                        data: {
                            deviceName: value
                        },
                        cache: false,
                        errorMsg: true,
                        dataType: 'json',
                        loading:true,
                        success: function (result) {
                            window.location.reload();
                        }
                    });
                    layer.close(index);
                });

            }
        }
    });

</script>


<script>
    layui.config({base: '${_contextPath}/web/layuiadmin/'});
    layui.extend({index: 'lib/index'});
    layui.use(['index','form','table'], function () {
        vue1.init();
    });
</script>
</body>
</html>