<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Edit Admin - IoT Demo</title>
    <#include "/web/views/common/header.html" />
</head>
<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <!-- Header -->
        <div class="layui-header">
            <div class="layui-logo layui-hide-xs layui-bg-black">IoT Demo - Admin</div>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                    <a href="javascript:;">
                        <img src="${_contextPath}/web/layuiadmin/images/head.jpg" class="layui-nav-img">
                        ${username!'Admin'}
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="${_contextPath}/logout">Logout</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
        
        <!-- Sidebar -->
        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item">
                        <a href="${_contextPath}/dashboard">Dashboard</a>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a class="" href="javascript:;">Admin Management</a>
                        <dl class="layui-nav-child">
                            <dd><a href="${_contextPath}/admin/list">View Admins</a></dd>
                            <dd><a href="${_contextPath}/admin/add">Add Admin</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="${_contextPath}/index.html">IoT Dashboard</a>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Content -->
        <div class="layui-body">
            <div style="padding: 15px;">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h2>Edit Administrator</h2>
                            <a href="${_contextPath}/admin/list" class="layui-btn layui-btn-primary">Back to List</a>
                        </div>
                    </div>
                    <div class="layui-card-body">
                        <#if successMsg??>
                            <div class="layui-alert layui-alert-success" style="margin-bottom: 15px;">
                                <i class="layui-icon layui-icon-ok-circle"></i> ${successMsg}
                            </div>
                        </#if>
                        
                        <#if errorMsg??>
                            <div class="layui-alert layui-alert-danger" style="margin-bottom: 15px;">
                                <i class="layui-icon layui-icon-close-circle"></i> ${errorMsg}
                            </div>
                        </#if>
                        
                        <form class="layui-form" action="${_contextPath}/admin/edit/${admin.id}" method="post" style="max-width: 500px;">
                            <div class="layui-form-item">
                                <label class="layui-form-label">Admin ID</label>
                                <div class="layui-input-block">
                                    <input type="text" value="${admin.id}" readonly class="layui-input layui-disabled">
                                </div>
                            </div>
                            
                            <div class="layui-form-item">
                                <label class="layui-form-label">Username</label>
                                <div class="layui-input-block">
                                    <input type="text" name="username" value="${admin.username}" required lay-verify="required" placeholder="Enter username" class="layui-input">
                                </div>
                            </div>
                            
                            <div class="layui-form-item">
                                <label class="layui-form-label">New Password</label>
                                <div class="layui-input-block">
                                    <input type="password" name="password" placeholder="Leave empty to keep current password" class="layui-input">
                                    <div class="layui-form-mid layui-word-aux">Minimum 6 characters (optional)</div>
                                </div>
                            </div>
                            
                            <div class="layui-form-item">
                                <label class="layui-form-label">Confirm Password</label>
                                <div class="layui-input-block">
                                    <input type="password" name="confirmPassword" placeholder="Confirm new password" class="layui-input">
                                </div>
                            </div>
                            
                            <div class="layui-form-item">
                                <label class="layui-form-label">Created At</label>
                                <div class="layui-input-block">
                                    <input type="text" value="${admin.createdAtAsDate?string('yyyy-MM-dd HH:mm:ss')}" readonly class="layui-input layui-disabled">
                                </div>
                            </div>
                            
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn" lay-submit lay-filter="editAdmin">Update Admin</button>
                                    <a href="${_contextPath}/admin/list" class="layui-btn layui-btn-primary">Cancel</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="layui-footer">
            Â© 2024 IoT Demo - Phase 1 Admin System
        </div>
    </div>

    <script src="${_contextPath}/web/layuiadmin/layui/layui.js"></script>
    <script>
        layui.use(['form'], function(){
            var form = layui.form;
            
            // Custom validation for password confirmation
            form.verify({
                confirmPass: function(value, item) {
                    var password = document.querySelector('input[name="password"]').value;
                    if (password && !value) {
                        return 'Please confirm the new password';
                    }
                    if (password && value !== password) {
                        return 'Passwords do not match';
                    }
                }
            });
            
            // Add confirm password validation
            document.querySelector('input[name="confirmPassword"]').setAttribute('lay-verify', 'confirmPass');
        });
    </script>
</body>
</html>